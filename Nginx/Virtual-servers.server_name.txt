Virtual servers. server_name

##########
# server #
##########

Syntax:	server { ... }
Default:	—
Context:	http

  Задает конфигурацию виртуального сервера.

  Не существует четкого разделения между
    * виртуальными серверами, IP-based (основанными на IP-адресе)
  <и>
    * name-based (на основе поля заголовка запроса "Host").

  Вместо этого
    -> директивы listen описывают все адреса и порты, которые должны принимать соединения для сервера,
    -> а директива server_name перечисляет все имена серверов.
    Примеры конфигураций: см. “How nginx processes a request”


***************
* server_name *
***************

Syntax:	server_name name ...;
Default:	
server_name "";
Context:	server


  Устанавливает имена виртуального сервера.

Пример:

-->
server {
    server_name example.com www.example.com;
}
<--

  Первое имя становится основным (primary) именем сервера.

  Имена серверов могут содержать звездочку ("*"), заменяющую первую или последнюю часть имени:

---<wildcard_names>---
server {
    server_name example.com *.example.com www.example.*;
}
---

# Такие имена называются подстановочными (wildcard names).


  Первые два из перечисленных выше имен (example.com *.example.com)
  могут быть объединены в одно:
-->
server {
    server_name .example.com;
}
<--


Также можно использовать регулярные выражения в именах серверов, предваряя имя тильдой ("~"):

---<regex-in-server-name>---
server {
    server_name www.example.com ~^www\d+\.example\.com$;
}
---

Регулярные выражения могут содержать записи (= captures) (0.7.40), которые впоследствии могут быть использованы в других директивах:

---<captures-in-server-name>---
server {
    server_name ~^(www\.)?(.+)$;

    location / {
        root /sites/$2;
    }
}

server {
    server_name _;

    location / {
        root /sites/default;
    }
}
---

Именованные записи (= Named captures) в регулярных выражениях создают переменные (0.8.25),
которые впоследствии могут быть использованы в других директивах:

---<Named-captures>---
server {
    server_name ~^(www\.)?(?<domain>.+)$;

    location / {
        root /sites/$domain;
    }
}

server {
    server_name _;

    location / {
        root /sites/default;
    }
}
---


(!) Если параметр директивы имеет значение «$hostname» (0.9.4), => вставляется имя хоста машины.

Также можно указать пустое имя сервера (0.7.11):

---<empty-server-name>---
server {
    server_name www.example.com "";
}
---

# Позволяет этому серверу обрабатывать запросы без поля заголовка «Host» (вместо сервера по умолчанию)
# для заданной пары адрес:порт.
#! Это настройка по умолчанию.

## До версии 0.8.48 по умолчанию использовалось имя хоста машины.


[!] При поиске виртуального сервера по имени, если имя соответствует более чем одному из указанных вариантов
    (например, совпадает и имя с подстановочным знаком, и регулярное выражение),
    будет выбран ПЕРВЫЙ ПОДХОДЯЩИЙ ВАРИАНТ, в следующем порядке приоритета:

  1) точное имя (the exact name)
  2) самое длинное имя (wildcard name) с подстановочным знаком, НАЧИНАЮЩЕЕСЯ с *,
      например «*.example.com»
  3) самое длинное имя с подстановочным знаком, ЗАКАНЧИВАЮЩЕЕСЯ *,
     например «mail.*»
  4) первое совпадающее регулярное выражение (в порядке появления в файле конфигурации)

Подробное описание имен серверов приведено в отдельном документе «Имена серверов».
(https://nginx.org/en/docs/http/server_names.html)
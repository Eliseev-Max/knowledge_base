Понимание доступа по SSH к Gitea (без passthrough)

Чтобы понять, что должно произойти, сначала нужно понять, что происходит без passthrough. Поэтому мы постараемся объяснить это:

    Клиент добавляет свой открытый ключ SSH в Gitea с помощью веб-страницы.
    Gitea добавляет запись для этого ключа в файл .ssh/authorized_keys запущенного пользователя git.
    Эта запись содержит открытый ключ, но также имеет опцию command=. Именно эту команду Gitea использует для сопоставления этого ключа с пользователем клиента и управления аутентификацией.
    Затем клиент делает SSH-запрос к SSH-серверу, используя пользователя git, например, git clone git@domain:user/repo.git.
    Клиент попытается аутентифицироваться на сервере, передавая серверу один или несколько открытых ключей по одному.
    Для каждого ключа, переданного клиентом, SSH-сервер сначала проверит свою конфигурацию на наличие команды AuthorizedKeysCommand, чтобы проверить, соответствует ли открытый ключ, а затем файл authorized_keys пользователя git.
    Будет выбрана первая подходящая запись, и если это запись Gitea, то будет выполнена команда command=.
    SSH-сервер создает пользовательскую сессию для пользователя git и, используя оболочку для пользователя git, выполняет команду=.
    Это запускает gitea serv, который берет на себя управление остальной частью SSH-сессии и управляет аутентификацией и авторизацией gitea для команд git.

Теперь, чтобы SSH passthrough работал, нам нужно, чтобы SSH хоста соответствовал открытым ключам, а затем запустить gitea serv на докере. Существует несколько способов сделать это. Однако все они требуют передачи хосту некоторой информации о докере.

About Gitea:
1. Installation with Docker
	→ https://docs.gitea.io/en-us/install-with-docker/
	
2. Configuration Cheat Sheet
	→ https://docs.gitea.io/en-us/config-cheat-sheet/
	
3. Gitea – Setup SSH and Repository
	→ https://easycode.page/gitea-setup-ssh-and-repository/

4. How to Install Gitea on Ubuntu Using Docker
	→ https://www.digitalocean.com/community/tutorials/how-to-install-gitea-on-ubuntu-using-docker

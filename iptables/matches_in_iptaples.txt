Явные совпадения (explict matches)
https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html#MATCHES

Явные совпадения — это те, которые должны быть специально загружены с параметром -m или --match.
Совпадения состояний, например, требуют директивы -m state перед вводом фактического совпадения, которое вы хотите использовать.
Явные совпадения:
	• зависящие от протокола
	• не связанные с к.-л. протоколом (например, состояния подключения (connection states))

Типы подключений:
	• NEW, (новое) - первый пакет еще не установленного соединения
		Это первый пакет в данном соединении, который увидел модуль трассировщика.
		Например, SYN-пакет, являющийся первым для пакетом для данного соединения,
		или пакет, пришедший после закрытия соединения по таймауту.
		
	• ESTABLISHED, (установленное)  - соединение, которое уже зарегистрировано в ядре
		Требование: для перехода в состояние ESTABLISHED необходимо, чтобы узел сети передал пакет
		и получил на него ответ от другого узла (хоста).
		После получения ответа состояние соединения NEW или RELATED будет изаменено на ESTABLISHED.
		
	• RELATED, (связанное) - новое соединение, созданное старым, установленным соединением
		Соединение получает статус RELATED если оно связано с другим соединением, имеющим признак ESTABLISHED.
		Примеры:
			♦ соединение FTP-data, которое является связанным с портом FTP control;
			♦ DCC-соединение, запущенное из IRC
	• INVALID - пакет не может быть идентифицирован и поэтому не может иметь определенного статуса.
	• и т.д. (custom) - были разработаны для тестирования или экспериментальных целей, или просто для иллюстрации того, на что способен iptables

С каждым новым выпуском iptables появляются новые matches.

Разница между неявно загруженными (implicitly loaded) и явно загруженными (explicitly loaded) совпадениями
	♦ implicitly loaded matches будут загружаться автоматически, когда, например, вы сопоставляете свойства TCP-пакетов;
	♦ explicitly loaded matches никогда не будут загружаться автоматически,
								необходимо вручную обнаружить и активировать явные совпадения.

(ознакомиться с Table 10-6. Address types)

---
Понятие общих совпадений (generic matches)
	* общие совпадения можно использовать во всех правилах независимо от протокола;
	* помимо общих есть специализированные совпадения:
		• совпадения TCP - применяются только к TCP-пакетам;
		• совпадения UDP - применяются только к UDP-пакетам
		• совпадения ICMP - применяются только к ICMP-пакетам
		• специальные совпадения (совпадение состояния, владельца и ограничения и т.д.)
	* совпадение — это то, что указывает особое условие внутри пакета, которое должно быть истинным (или ложным)
	* одно правило может содержать несколько совпадений любого типа
		• например, пакеты, приходящие с определённого хоста LAN + на определённый порт
		• если хотя бы одно из всех совпадений fails → всё правило fails, проверяется следующее правило;
		• если все совпадения = true → применяется target, указанное в правиле.

Некоторые общие совпадения:
	-s, --src, --source
		- это сопоставление источника = сопоставление пакетов на основе их исходного IP-адреса.
		Можно использовать IP-адрес совместно с сетевой маской в бировой CIDR (/24) или обычной (255.255.255.0) форме.
		Можно инвертировать совпадение с помощью знака ! (--src ! 192.168.0.0/24 - все пакеты с исходным адресом, не входящим в диапазон)
	
	-d, --dst, --destination
		- это сопоставление используется для пакетов на основе их адреса (адресов) назначения.
		Принцип действия и синтаксис такой же, как и у --source, НО сопоставление основано на том, куда направляются пакеты.
		Также возможна инверсия с помощью "!"
	
	-i, --in-interface
		это совпадение используется для интерфейса, на который пришел пакет.
		Опция допустима только в цепочках:
			• INPUT,
			• FORWARD 
			• PREROUTING
		(в любых других  → сообщение об ошибке)
		Поведение по умолчанию: если конкретный интерфейс не указан, строковое значение +
		Одиночный знак + (=сопоставление строки букв и цифр) указывает ядру, что нужно нужно сопоставлять все пакеты,
		независимо от того, через какой интерфейс они поступили.
		eth+ = все устройства Ethernet.
		Можно инвертировать значение этой опции с помощью "!"
		
	-o, --out-interface
		это совпадение используется для пакетов на интерфейсе, с которого они отправляются.
		Совпадение доступно только в цепочках OUTPUT, FORWARD и POSTROUTING.
		Принцип действия и синтаксис такой же, как и у -i.
	
---
Неявные совпадения (Implict matches)
	Implict matches загружаются неявно (автоматически).
	Три типа неявных совпадений:
		♦ TCP matches;
		♦ UDP matches;
		♦ ICMP matches.
	Неявным совпадениям не требуется опция -m (--match)
	
	--sport, --source-port
		сопоставление пакетов на основе исходного порта.
		Это сопоставление может принимать:
			• имя службы
				имя службы должно быть в файле /etc/services (iptables использует этот файл для поиска)
				
			• номер порта
				правило загрузится немного быстрее, т.к. iptables не нужно проверять имя сервиса.
				Поддерживает диапазоны портов
				  --source-port 22:80 == порты с 22 по 80
				  --source-port :80 == ports(0 - 80)
				  --source-port 22: == ports(22 - 65535)
			Поддерживает инверсию (!)
			Это сопоставление не обрабатывает несколько отдельных портов и диапазонов портов	
		
	--dport, --destination-port
		используется для сопоставления пакетов TCP в соответствии с их портом назначения.
		Синтаксис и принцип действия = --source-port
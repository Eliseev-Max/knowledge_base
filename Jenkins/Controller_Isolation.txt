Controller Isolation

[sources:]
"Controller Isolation": https://www.jenkins.io/doc/book/security/controller-isolation/


"""
То, что именно происходит во время сборки, часто контролируется людьми,
которым доверяют меньше (less trusted), чем администратору Jenkins:
  * Пользователи Jenkins с правами Job/Configure;
  * Авторы сценариев сборки (pom.xml, Makefile и т. д.)
  * Авторы кода (например, тестового кода, выполняемого во время сборки)

Все они имеют определенный контроль над командами, выполняемыми во время сборки.
"""

[Критерий обеспечения стабильности работы контроллера Jenkins:]

  (!) сборки должны выполняться на нодах, отличных от ноды встроенного узла.

[!] Эта концепция называется РАСПРЕДЕЛЕННЫМИ СБОРКАМИ в Jenkins
(узнать об этом больше:
#-> "Architecting for Scale": https://www.jenkins.io/doc/book/scaling/architecting-for-scale/

Настройка распределенных сборок в Jenkins - это отличное начало для защиты контроллера Jenkins от вредоносных (или просто сломанных) сценариев сборки,
(!) Соблюдение осторожности => путь к эффективной защите

"""
Большинство сред Jenkins со временем развиваются, и модели доверия должны меняться по мере роста среды.
(!) планируйте регулярные "чек-апы", чтобы проверить,
    следует ли снова включить какие-либо отключенные параметры безопасности.
"""

##########################################
# Не запускать сборки на встроенном узле #
##########################################

  Из коробки Jenkins настроен на запуск сборок на встроенном узле.

---<Зачем это сделано?>---
  Это сделано для того, чтобы облегчить начало работы с Jenkins,
  НО в долгосрочной перспективе это нежелательно!

[!] Любые сборки, запущенные на встроенном узле, имеют такой же УРОВЕНЬ ДОСТУПА К ФАЙЛОВОЙ СИСТЕМЕ КОНТРОЛЛЕРА,
    как и процесс Jenkins.
    Поэтому НАСТОЯТЕЛЬНО РЕКОМЕНДУЕТСЯ НЕ ЗАПУСКАТЬ сборки на встроенном узле,
    а использовать для запуска сборок АГЕНТОВ
    (статически настроенных или предоставленных облаками (= Jenkins Clouds)).

(*) Чтобы ЗАПРЕТИТЬ сборкам запускаться непосредственно на встроенном узле:
  1) перейдите в Manage Jenkins -> Nodes and Clouds
  2) выберите Built-In Node в списке
  3) затем выберите Configure в меню.
  4) установите число исполнителей на 0
  5) сохраните изменения.

[!] Убедитесь, что вы также настроили clouds или build agents для запуска сборок,
    иначе сборки НЕ СМОГУТ ЗАПУСТИТЬСЯ.

[Альтернативный способ:]
  В качестве альтернативы используйте плагин "Job Restrictions Plugin",
#(https://plugins.jenkins.io/job-restrictions/)
  чтобы ограничить выполнение заданий на определенных узлах (например, на встроенном узле),
(!)  НЕЗАВИСИМО ОТ ТОГО, что ваши менее доверенные пользователи могут использовать в качестве выражения
  метки в конфигурации своих заданий.


---<Альтернативный способ добиться изоляции>---
Если у вас нет других компьютеров для запуска агентов,
вы также можете запустить процесс агента ОТ ИМЕНИ ДРУГОГО ПОЛЬЗОВАТЕЛЯ ОПЕРАЦИОННОЙ СИСТЕМЫ в той же системе,
чтобы добиться аналогичного эффекта изоляции.
В этом случае убедитесь, что
  * процесс агента НЕ ИМЕЕТ ДОСТУПА К ФАЙЛОВОЙ СИСТЕМЕ
    (ни на чтение, ни на запись) К ДОМАШНЕМУ КАТАЛОГУ Jenkins;
  * процесс агента не может использовать sudo или аналогичные методы для повышения собственных прав доступа.
---

*************************************
* Agent → Controller Access Control *
*************************************

  Контроллер Jenkins и агентов можно представить как распределенный процесс,
  выполняющийся на нескольких дискретных процессах и машинах.
  Это позволяет агенту:
    + запрашивать у ПРОЦЕССА КОНТРОЛЛЕРА доступную ему информацию,
      (например, содержимое файлов и т. д.)
    + заставлять контроллер ВЫПОЛНЯТЬ ОПРЕДЕЛЕННЫЕ КОМАНДЫ ПО ЗАПРОСУ АГЕНТА.
  
[!] процесс агента, захваченный злоумышленником, все равно сможет получать данные или выполнять команды на контроллере Jenkins!
  Чтобы предотвратить это, система Agent → Controller Access Control НЕ ПОЗВОЛЯЕТ процессам агента отправлять ВРЕДОНОСНЫЕ КОМАНДЫ на контроллер Jenkins.

Эта система ВСЕГДА ВКЛЮЧЕНА, начиная с версии Jenkins 2.326
(см. раздел Изменения безопасности Agent → Controller в версии 2.326).
#"Agent → Controller Security Changes in 2.326": https://www.jenkins.io/doc/book/security/controller-isolation/jep-235/

"""
  Jenkins 2.326 removes the ability to disable or customize the agent-to-controller security system.
  This change is specified in JEP-235.
"""

В Jenkins 2.325 и более ранних версиях она ВКЛЮЧЕНА ПО УМОЛЧАНИЮ,
но может быть отключена в веб-интерфейсе путем снятия флажка на странице Manage Jenkins -> Security.

[!] Настоятельно рекомендуется не отключать систему Agent → Controller Access Control.

---{MORE}---
"Customizing Agent → Controller Security":
 => https://www.jenkins.io/doc/book/security/controller-isolation/agent-to-controller/
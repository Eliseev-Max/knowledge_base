apt (Advanced Package Tool)

Advanced Packaging Tool – набор утилит для управления программными пакетами в операционных системах основанных на Debian.
APT предоставляет дружественную надстройку над DPKG.

Используется в дистрибутивах, основанных на Debian (Ubuntu)
Может:
	• устанавливать пакеты:
		► из удалённых репозиториев;
		► из файлов;
	• загружать пакеты без установки;
	• удалять пакеты;
	• обновлять установленные пакеты;
	• искать пакеты;
	• решать зависимости
	• просматривать подробную информацию о пакете
	
# Все зависимости разрешаются автоматически

  - Не поддерживается частичное обновление пакетов (как в Zypper)

Настройки
	Все файлы настроек APT хранятся в директории /etc/apt.
	♦ /etc/apt/apt.conf – основной файл настроек, используемый всеми инструментами из состава APT
	(подробнее - $man apt.conf)
	♦ /apt.conf.d - директория содержащая в себе файлы конфигурации, аналогичные по синтаксису apt.conf.
	    При помощи этой директории можно быстро и удобно манипулировать настройками APT, добавляя или удаляя подготовленные файлы с настройками. 
	♦ auth.conf - файл, содержащий ключи, для авторизации в репозиториях.
	    Например, туда добавляются логины и пароли от репозиториев к купленным в Центре приложений программам.
	♦ sources.list - файл с перечнем репозиториев.
	♦ sources.list.d - директория с файлами репозиторий, по назначению аналогичных sources.list.
	    Каждый репозиторий описывается в отдельном файле.

Использование
	В APT входит несколько утилит, выполняющих отдельные задачи.
	(начиная с Ubuntu 16.04)► утилита apt
	☼ Утилита apt
		• содержит наиболее часто используемые команды из apt-get и apt-cache
		• предназначена для пользователей
		◘ (apt-get можно рассматривать как как инструмент более низкого уровня)
	
	☼ Утилита apt-get
		- утилита управления пакетами.
		→ apt-get требует прав суперпользователя для своей работы.
		
	  Основные команды:
	  	• update - Обновить информацию о пакетах, содержащихся в репозиториях.
		• install <pkg> - Установить пакет <pkg>.
		    Скачивание, установка и настройка происходят автоматически.
			Если для настройки пакета <pkg> нужны дополнительные сведения, будет показан запрос к пользователю.
		• upgrade - Обновление пакетов, для которых в репозитории доступны новые версии.
		• dist-upgrade - Обновление пакетов, требующих разрешения зависимостей (установка дополнительных или удаление конфликтующих пакетов).
		• remove <pkg> - Удаление пакета <pkg> из системы.
		• purge <pkg> - Удаление пакета <pkg> и очистка системы от его конфигурационных файлов.
		    Файлы настроек в домашних каталогах пользователей удалены не будут.
		• autoremove - Удаление пакета, который более не нужен в системе.
		    Используется для очистки системы от ненужных пакетов. 
			Когда пакет считается ненужным:
			  если пакет был установлен не сам по себе, а как зависимость для другого пакета, который впоследствии был удалён.
		• source <pkg> - получение исходных текстов пакета <pkg>.
		• build-dep <pkg> - получение зависимостей для сборки пакета <pkg>.
	  Разрешение зависимостей в случае сбоя в базе пакетов:
	    $ sudo apt-get install -f
	
	☼ Утилита apt-cache
		- утилита, позволяющая выполнять запросы к кешу APT.
		
	  Основные команды:
	    • search - поиск пакета по части названия или описания.
		    Поддерживает регулярные выражения.
		• show - информация о пакете: версия, размер, описание и т. п.
		• depends - зависимости указанного пакета.
		• rdepends - обратные зависимости пакета.
	
	☼ Утилита apt-key
		- служит для добавления ключей от репозиториев в систему.
		Ключи защищают репозитории от возможности подделки пакета.
	  
	  Основные команды:
	      •add - Добавление ключа в базу доверенных ключей.
		  • del - Удаление ключа из доверенных.

---
<Использование утилиты apt:>

Синтаксис команды apt:
	$ apt [опции] команда [параметры_команды]
	
			    опции:	  общее поведение утилиты;
			  команда:	  действие, которое нужно выполнить;
	параметры_команды:	  передаётся (обычно) имя пакета, с которым требуется работать

Основные опции утилиты apt:
	
	-v, --version - выводит версию утилиты;
    -h, --help - выводит справку по использованию утилиты;
    -y, --yes - автоматически отвечать "да" на все возникающие вопросы;
    --assume-no - автоматически отвечать "нет" на все возникающие вопросы;
    -d, --download-only - только скачать пакеты и больше ничего не делать;
    -f, --fix-broken - исправить недостающие зависимости;
    --no-download - ничего не загружать, использовать только пакеты из кэша;
    -s, --simulate - режим симуляции, никакие операции не выполняются, только выводится информация на экран;
    --allow-unauthenticated - позволяет установить пакеты, из репозиториев, для которых нет GPG подписи;
    --no-install-recommends - не устанавливать рекомендованные пакеты, по умолчанию будут установлены;
    -m, --ignore-missing - игнорировать пакеты, которые существует;
    -q, --quiet - выводить минимум информации, не показывать прогресс бар;
    -V, --verbose-versions - показывать полные версии обновленных пакетов;
    --only-upgrade - не устанавливать новые пакеты, только обновлять;
    --allow-downgrades - разрешить откатывать версию пакетов;
    --reinstall - переустановить пакет если он уже установлен;

Команды утилиты apt:
	
	install - установить пакет;
    remove - удалить пакет, конфигурационные файлы, которые были изменены в вашей системе удалены не будут;
    purge - полностью удалить пакет, вместе со всеми его конфигурационными файлами;
    autoremove - очистить ненужные пакеты;
    autoclean - очистить кэш пакетов;
    update - обновить списки пакетов из репозиториев;
    upgrade - обновить версию пакета до последней, если пакет не указан будут обновлены все пакеты;
    full-upgrade - полное обновление системы, включая удаление несовместимых или больше ненужных пакетов;
    list - список установленных пакетов;
    search - поиск пакетов;
    show - посмотреть информацию о пакете;
    download - скачать пакет в текущую папку;
    edit-sources - открыть с настройками репозиториев в текстовом редакторе.
    source - скачать исходный код пакета в текущую папку;
    build-dep - установить зависимости необходимые для сборки выбранного пакета;

Префиксы URL репозиториев:
	• Hit (Сущ) - список не изменился с момента предыдущей загрузки;
    • Ign (Игн) - репозиторий игнорируется, либо он слишком новый, либо произошла незначительная ошибка во время загрузки;
    • Get (Пол) - доступна новая версия и она будет загружена.

Практическое применение:
	► Посмотреть, для каких пакетов доступны обновления:
		$ sudo apt update
		$ sudo apt list --upgradable

	► Посмотреть установленные пакеты apt:
		$ sudo apt list --installed
		
	► Посмотреть все доступные пакеты:
		$ sudo apt list --all-versions
		
	► Обновить ВСЕ пакеты в системе:
		$ sudo apt full-upgrade

	► Переустановить пакет (в случае некорректной установки):
		$ sudo apt install <название_пакета> --reinstall
		
	► Установить несколько пакетов последовательно:
		$ sudo apt install <пакет_1> <пакет_2> -y
		
	► Если мы установили пакет с помощью dpkg, и хотим установить для него зависимости:
		$ sudo dpkg -i some_package.deb
		$ sudo apt install --fix-broken

	► Скачать deb-пакет в текущую папку без установки:
		$ apt download <название_пакета>

Чтобы не подтверждать установку вручную используем опцию -y. 

Скачивать пакеты надо от имени обычного пользователя, иначе тогда они не будут доступны для работы с ними.

Если нужно установить пакет из файла, просто передать путь к файлу команде install:
	$ sudo apt install home/current_user/path/to/pkg.deb

Установить определённую версию пакета:
	$ sudo apt install <название_пакета>=<версия>

Найти доступные версии:
	$ sudo apt policy <название_пакета>
	# Команда отображает информацию о том какая версия установлена, а также какие версии доступны

Выполнить поиск пакетов (если известно точное название пакета):
	$ sudo apt search <точное_название_пакета>

Очистить кэш пакетов:
	$ sudo apt autoclean

Про файлы конфигурации apt.conf и /apt.conf.d
[q:] Для чего нужны конфигурационные файлы (apt.conf и apt.conf.d/*)?
[a:] Конфигурационные файлы (apt.conf и apt.conf.d/*) позволяют пользователям настраивать работу различных функций apt.
	 Общие настройки касаются локальных прокси-серверов и функции неуправляемых обновлений.
	
[q:] Почему некоторые файлы отсутствуют в директории /apt.conf.d?
[a:] Некоторые файлы со ссылками могут отсутствовать в вашей системе. Это нормально.
	 Различные файлы конфигурации помещаются/удаляются в каталог apt.conf.d/ по мере необходимости различными пакетами (или вами).
	 Именно поэтому существует каталог apt.conf.d/ - чтобы приложения могли вносить изменения, не редактируя единственный главный файл конфигурации.

[q:] Почему имена некоторых файлы в директории /apt.conf.d начинаются с цифр?
[a:] Файлы в каталоге apt.conf.d/ загружаются в алфавитно-цифровом порядке.
	 Вот почему имена файлов в этом каталоге включают цифры!
	 Порядок важен: если два файла пытаются изменить одну и ту же настройку, побеждает последний загруженный файл.
	 (Если вы обнаружили два файла, пытающихся изменить одну и ту же настройку по-разному, → ОШИБКА! Сообщить разработчикам!


[ sources:
	1. Пакетный менеджер APT
	   https://help.ubuntu.ru/wiki/apt
	2. * Linux/Ubuntu. пакетный менеджер APT (Developer notes)
	   https://notes84.blogspot.com/2014/01/linuxubuntu-apt.html
	3. apt.conf(5) - Linux man page
	   https://linux.die.net/man/5/apt.conf
	4. * apt.conf - Ubuntu manuals
	   https://manpages.ubuntu.com/manpages/focal/man5/apt.conf.5.html
	5. * apt.conf(5) # Рускоязычный ресурс
	   https://www.opennet.ru/man.shtml?topic=apt.conf&category=5&russian=0
]